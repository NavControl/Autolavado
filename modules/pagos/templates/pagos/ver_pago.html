{% extends 'admin/base.html' %}
{% block title %}Detalle del Pago{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="fas fa-receipt me-2"></i>Detalle del Pago</h5>
      <a href="{{ url_for('pagos_bp.lista_pagos') }}" class="btn btn-light btn-sm">
        <i class="fas fa-arrow-left"></i> Volver
      </a>
    </div>

    <div class="card-body">
      <dl class="row mb-4">
        <dt class="col-sm-3">Cliente:</dt>
        <dd class="col-sm-9">{{ pago.nombre_completo }}</dd>

        <dt class="col-sm-3">Correo:</dt>
        <dd class="col-sm-9">{{ pago.correo }}</dd>

        <dt class="col-sm-3">Servicio:</dt>
        <dd class="col-sm-9">{{ pago.servicio or '—' }}</dd>

        <dt class="col-sm-3">Método:</dt>
        <dd class="col-sm-9 text-capitalize">{{ pago.metodo }}</dd>

        <dt class="col-sm-3">Monto:</dt>
        <dd class="col-sm-9">${{ "%.2f"|format(pago.monto) }}</dd>

        <dt class="col-sm-3">Estado:</dt>
        <dd class="col-sm-9">
          {% if pago.estado == 'pagado' %}
            <span class="badge bg-success">Pagado</span>
          {% elif pago.estado == 'pendiente' %}
            <span class="badge bg-warning text-dark">Pendiente</span>
          {% else %}
            <span class="badge bg-secondary">{{ pago.estado }}</span>
          {% endif %}
        </dd>

        <dt class="col-sm-3">Referencia PayPal:</dt>
        <dd class="col-sm-9">{{ pago.codigo_referencia or '—' }}</dd>

        <dt class="col-sm-3">Fecha de pago:</dt>
        <dd class="col-sm-9">{{ pago.fecha_pago or '—' }}</dd>
      </dl>

      <hr>

      <div class="d-flex justify-content-end">
        <!-- 💌 Reenviar Ticket -->
        <form method="POST" action="{{ url_for('pagos_bp.reenviar_ticket', id_pago=pago.id_pago) }}" class="me-2">
          <button type="submit" class="btn btn-outline-primary">
            <i class="fas fa-envelope me-1"></i> Reenviar Ticket al correo
          </button>
        </form>

        <!-- ✏️ Editar -->
        <a href="{{ url_for('pagos_bp.editar_pago', id_pago=pago.id_pago) }}" class="btn btn-outline-warning">
          <i class="fas fa-edit me-1"></i> Editar
        </a>
      </div>
    </div>
  </div>
</div>

<!-- 🧨 SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- ✅ Mostrar alertas de Flask -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          Swal.fire({
            toast: true,
            position: 'top-end',
            icon: '{{ "success" if category in ["success","info"] else "error" }}',
            title: '{{ message }}',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
          });
        {% endfor %}
      {% endif %}
    {% endwith %}
  });
</script>
{% endblock %}
