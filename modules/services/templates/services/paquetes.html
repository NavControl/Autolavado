{% extends 'admin/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fa fa-boxes me-2"></i>Paquetes de Servicios</h2>
        <a href="/services/crear-paquete" class="btn btn-success">
            <i class="fa fa-plus-circle me-2"></i>Crear Nuevo Paquete
        </a>
    </div>

    {% if datos_paquetes %}
    <div class="row">
        {% for paquete in datos_paquetes %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{{ paquete.nombre }}</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ paquete.descripcion or 'Sin descripción' }}</p>
                    
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fa fa-list me-1"></i>
                            {{ paquete.total_servicios }} servicio(s) incluido(s)
                        </small>
                    </div>
                    
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fa fa-clock me-1"></i>
                            Duración: {{ paquete.duracion_total }} min
                        </small>
                    </div>
                    
                    <div class="servicios-incluidos mb-3">
                        <small><strong>Servicios:</strong> {{ paquete.servicios_nombres or 'Ninguno' }}</small>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="text-success mb-0">${{ paquete.precio }}</h4>
                        <small class="text-muted">Precio del paquete</small>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="btn-group w-100">
                        <a href="/services/paquete/{{ paquete.id_paquete }}" class="btn btn-outline-info btn-sm">
                            <i class="fa fa-eye"></i>
                        </a>
                        <a href="/services/editar-paquete/{{ paquete.id_paquete }}" class="btn btn-outline-warning btn-sm">
                            <i class="fa fa-edit"></i>
                        </a>
                        <button class="btn btn-outline-danger btn-sm" onclick="eliminarPaquete({{ paquete.id_paquete }})">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fa fa-boxes fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">No hay paquetes creados</h4>
        <p class="text-muted">Comienza creando tu primer paquete de servicios.</p>
        <a href="/services/crear-paquete" class="btn btn-primary">
            <i class="fa fa-plus-circle me-2"></i>Crear Primer Paquete
        </a>
    </div>
    {% endif %}
</div>

<script>
async function eliminarPaquete(idPaquete) {
    const confirmacion = await mostrarConfirmacion('¿Estás seguro de eliminar este paquete?');
    if (!confirmacion) return;

    try {
        const response = await fetch('/services/eliminar-paquete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id_paquete: idPaquete })
        });

        const data = await response.json();
        
        if (data.message === "OK") {
            alert('Paquete eliminado correctamente');
            location.reload();
        } else {
            alert('Error al eliminar el paquete');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al eliminar el paquete');
    }
}

function mostrarConfirmacion(mensaje) {
    return new Promise((resolve) => {
        resolve(confirm(mensaje));
    });
}
</script>

<style>
.card {
    transition: transform 0.2s;
}
.card:hover {
    transform: translateY(-5px);
}
.servicios-incluidos {
    max-height: 60px;
    overflow: hidden;
}
</style>
{% endblock %}