{% extends 'admin/base.html' %}
{% block title %}Editar usuario{% endblock %}

{% block content %}
<div class="form-container">

    <div class="form-card">
        <div class="form-header">
            <div class="form-title">
                <i class="fa fa-user-edit"></i>
                Editar usuario
            </div>
            <div class="form-subtitle">
                Modifique los campos que desea actualizar del usuario
            </div>
        </div>

        <form method="POST" class="needs-validation" novalidate>
            <!-- Datos básicos -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inpUsuario" class="form-label">Usuario</label>
                    <input type="text" class="form-control" id="inpUsuario" name="inpUsuario"
                           value="{{ usuario.username }}" placeholder="Ingrese el nombre de usuario" required>
                    <div class="invalid-feedback">
                        Por favor ingrese un nombre de usuario válido.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="inpNombre" class="form-label">Nombre completo</label>
                    <input type="text" class="form-control" id="inpNombre" name="inpNombre"
                           value="{{ usuario.nombre_completo }}" placeholder="Ingrese el nombre completo" required>
                    <div class="invalid-feedback">
                        Por favor ingrese un nombre completo válido.
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="inpCorreo" class="form-label">Correo electrónico</label>
                    <input type="email" class="form-control" id="inpCorreo" name="inpCorreo"
                           value="{{ usuario.correo }}" placeholder="usuario@ejemplo.com" required>
                    <div class="invalid-feedback">
                        Por favor ingrese un correo electrónico válido.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="inpTelefono" class="form-label">Teléfono</label>
                    <input type="tel" class="form-control" id="inpTelefono" name="inpTelefono"
                           value="{{ usuario.telefono }}" placeholder="Ejemplo: 5551234567" pattern="[0-9]{10}" required>
                    <div class="invalid-feedback">
                        Ingrese un número de teléfono válido (10 dígitos).
                    </div>
                </div>
            </div>

            <!-- Datos laborales -->
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="fecha_contratacion" class="form-label">Fecha de contratación</label>
                    <input type="date" class="form-control" id="fecha_contratacion" name="fecha_contratacion"
                           value="{{ usuario.fecha_contratacion|default('', true) }}">
                </div>

                <div class="col-md-4 mb-3">
                    <label for="salario" class="form-label">Salario</label>
                    <input type="number" class="form-control" id="salario" name="salario" step="0.01"
                           placeholder="Ejemplo: 5000.00" value="{{ usuario.salario|default('', true) }}">
                </div>

                <div class="col-md-4 mb-3">
                    <label for="turno" class="form-label">Turno</label>
                    <select class="form-select" id="turno" name="turno">
                        <option value="matutino" {% if usuario.turno == 'matutino' %}selected{% endif %}>Matutino</option>
                        <option value="vespertino" {% if usuario.turno == 'vespertino' %}selected{% endif %}>Vespertino</option>
                        <option value="nocturno" {% if usuario.turno == 'nocturno' %}selected{% endif %}>Nocturno</option>
                    </select>
                </div>
            </div>

            <!-- Rol y Estado -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="slcRol" class="form-label">Rol</label>
                    <select class="form-select" id="slcRol" name="slcRol" required>
                        <option value="" disabled>Seleccione un rol</option>
                        {% for rol in datos_roles %}
                        <option value="{{ rol.id_rol }}" {% if rol.id_rol == usuario.id_rol %}selected{% endif %}>
                            {{ rol.nombre }}
                        </option>
                        {% endfor %}
                    </select>
                    <div class="invalid-feedback">
                        Por favor seleccione un rol para el usuario.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label for="estado" class="form-label">Estado del Usuario</label>
                    <select class="form-select" id="estado" name="estado" required>
                        <option value="activo" {% if usuario.estado == 'activo' %}selected{% endif %}>Activo</option>
                        <option value="inactivo" {% if usuario.estado == 'inactivo' %}selected{% endif %}>Inactivo</option>
                        <option value="bloqueado" {% if usuario.estado == 'bloqueado' %}selected{% endif %}>Bloqueado</option>
                    </select>
                    <div class="invalid-feedback">
                        Por favor seleccione un estado válido.
                    </div>
                </div>
            </div>

            <!-- Botones -->
            <div class="btn-form-group text-end mt-4">
                <a href="{{ url_for('admin.usuarios') }}" class="btn btn-outline-danger me-2">
                    <i class="fa fa-times fa-sm me-1"></i>Cancelar
                </a>
                <button type="submit" class="btn btn-primary">
                    <i class="fa fa-save fa-sm me-1"></i>Actualizar Usuario
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Validación Bootstrap -->
<script>
(function () {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
})();
</script>
{% endblock %}
