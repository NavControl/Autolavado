{% extends 'admin/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fa fa-boxes me-2"></i>Paquetes de Servicios</h2>
        <a href="/services/crear-paquete" class="btn-modern btn-modern-success">
            <i class="fa fa-plus-circle me-2"></i>Crear Nuevo Paquete
        </a>
    </div>

    {% if datos_paquetes %}
    <div class="row">
        {% for paquete in datos_paquetes %}
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card h-100 shadow-sm package-card" 
                 data-package-id="{{ paquete.id_paquete }}"
                 onclick="editarPaquete({{ paquete.id_paquete }})">
                
                <!-- Botón de eliminar (solo visible en hover) -->
                <div class="delete-overlay" onclick="event.stopPropagation(); eliminarPaquete({{ paquete.id_paquete }})">
                    <i class="fa fa-times"></i>
                </div>
                
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">{{ paquete.nombre }}</h5>
                </div>
                <div class="card-body">
                    <p class="card-text">{{ paquete.descripcion or 'Sin descripción' }}</p>
                    
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fa fa-list me-1"></i>
                            {{ paquete.total_servicios }} servicio(s) incluido(s)
                        </small>
                    </div>
                    
                    <div class="mb-2">
                        <small class="text-muted">
                            <i class="fa fa-clock me-1"></i>
                            Duración: {{ paquete.duracion_total }} min
                        </small>
                    </div>
                    
                    <div class="servicios-incluidos mb-3">
                        <small><strong>Servicios:</strong> {{ paquete.servicios_nombres or 'Ninguno' }}</small>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="text-success mb-0">${{ paquete.precio }}</h4>
                        <small class="text-muted">Precio del paquete</small>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="fa fa-boxes fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">No hay paquetes creados</h4>
        <p class="text-muted">Comienza creando tu primer paquete de servicios.</p>
        <a href="/services/crear-paquete" class="btn btn-primary">
            <i class="fa fa-plus-circle me-2"></i>Crear Primer Paquete
        </a>
    </div>
    {% endif %}
</div>

<script>
// Función para editar paquete (al hacer clic en la tarjeta)
function editarPaquete(idPaquete) {
    window.location.href = `/services/editar-paquete/${idPaquete}`;
}

// Función para eliminar paquete (al hacer clic en la X)
async function eliminarPaquete(idPaquete) {
    // Detener la propagación del evento para evitar que se active el clic de la tarjeta
    event.stopPropagation();
    
    const confirmacion = await mostrarConfirmacion('¿Estás seguro de eliminar este paquete?');
    if (!confirmacion) return;

    try {
        const response = await fetch('/services/eliminar-paquete', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ id_paquete: idPaquete })
        });

        const data = await response.json();
        
        if (data.message === "OK") {
            alert('Paquete eliminado correctamente');
            location.reload();
        } else {
            alert('Error al eliminar el paquete');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al eliminar el paquete');
    }
}

function mostrarConfirmacion(mensaje) {
    return new Promise((resolve) => {
        resolve(confirm(mensaje));
    });
}

// Efectos adicionales para mejorar la experiencia de usuario
document.addEventListener('DOMContentLoaded', function() {
    // Agregar efecto de pulso al hacer hover sobre la X
    const deleteButtons = document.querySelectorAll('.delete-overlay');
    deleteButtons.forEach(btn => {
        btn.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.1)';
        });
        btn.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
.package-card {
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.package-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
}

/* Overlay de eliminación */
.delete-overlay {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    background: #dc3545;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    opacity: 0;
    transform: scale(0.8);
    transition: all 0.3s ease;
    z-index: 10;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
}

.package-card:hover .delete-overlay {
    opacity: 1;
    transform: scale(1);
}

.delete-overlay:hover {
    background: #c82333;
    transform: scale(1.1) !important;
}

/* Efecto de click en la tarjeta */
.package-card:active {
    transform: translateY(-2px) scale(0.98);
}

/* Mejoras visuales para el contenido */
.servicios-incluidos {
    max-height: 60px;
    overflow: hidden;
}

.card-header {
    border-bottom: none;
}

.card-body {
    padding: 1.25rem;
}

   /* Botones modernos - mismos estilos que la tabla de clientes */
    .btn-modern {
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border: 1px solid;
        cursor: pointer;
    }
    

    
     .btn-modern-primary {
        background: var(--bs-primary);
        border-color: var(--bs-primary);
        color: var(--bs-white);
    }
    
    .btn-modern-primary:hover {
        background: var(--bs-primary-dark);
        border-color: var(--bs-primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(var(--bs-primary-rgb), 0.3);
        color: var(--bs-white);
    }

/* Estado vacío mejorado */
.text-center.py-5 {
    background: #f8f9fa;
    border-radius: 12px;
    margin: 2rem 0;
}

/* Responsive */
@media (max-width: 768px) {
    .package-card {
        margin-bottom: 1rem;
    }
    
    .delete-overlay {
        width: 28px;
        height: 28px;
        font-size: 12px;
    }
}

@media (max-width: 576px) {
    .d-flex.justify-content-between.align-items-center.mb-4 {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .delete-overlay {
        opacity: 1; /* Mostrar siempre en móvil para mejor usabilidad */
        transform: scale(1);
    }
}
</style>
{% endblock %}